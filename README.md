# AntiZapret

Скрипт для установки на [своём сервере](https://github.com/UtyaVPN/AntiZapret-Core#где-купить-сервер) прокси-сервера AntiZapret

Через AntiZapret работают только (список сайтов автоматически обновляется раз в сутки с 2:00 до 4:00 по времени сервера):
- Заблокированные Роскомнадзором сайты и IP-адреса (например discord.com)
- Сайты, доступ к которым ограничивается незаконно (например youtube.com)
- Сайты, ограничивающие доступ из России (например intel.com, chatgpt.com)

Все остальные сайты работают без прокси через вашего провайдера с максимальной доступной скоростью, не нарушая работу сайтов проверяющих наличие у вас Российского IP-адреса (госуслуги, банки, интернет-магазины, стриминговые сервисы и тд)

Список сайтов и IP-адресов для AntiZapret предзаполнен и обновляется автором
Также доступно ручное добавление собственных сайтов и IP-адресов (include-hosts.txt и include-ips.txt в папке /root/antizapret/config)

**Внимание!** Для правильной работы AntiZapret нужно [отключить DNS в браузере](https://www.google.ru/search?q=отключить+DNS+в+браузере)

Ваш сервер должен быть расположен за пределами России и стран бывшего Советского Союза, в противном случае разблокировка сайтов не гарантируется

За основу взяты [эти исходники](https://bitbucket.org/anticensority/antizapret-vpn-container/src/master) разработанные ValdikSS
Скрипт отключает UFW и Firewalld, при необходимости их необходимо настроить и включить вручную
Протестировано на Ubuntu 22.04/24.04 и Debian 11/12 - Процессор: 1 core, Память: 1 Gb, Хранилище: 10 Gb, Внешний IPv4

***

## Установка и обновление
1. Устанавливать только на Ubuntu 22.04/24.04 или Debian 11/12 (рекомендуется Ubuntu 24.04)
2. Для установки или обновления в терминале под root выполнить
```sh
bash <(wget -qO- --no-hsts --inet4-only https://raw.githubusercontent.com/UtyaVPN/AntiZapret-Core/main/setup.sh)
```
3. Изменить настройки (или нажимать Enter для выбора значения по умолчанию):
	- Выбрать DNS
	- Включить блокировку рекламы, трекеров и фишинга на основе правил AdGuard и OISD
	- Использовать альтернативные диапазоны IP-адресов: 172... вместо 10...
	- Включить защиту от перебора паролей SSH и защиту от сканирования и сетевых атак
	- Ограничить маршрутизацию только к IP-адресам из config/forward-ips.txt и result/route-ips.txt
	- Пустить все домены через прокси кроме российских доменов и доменов из config/exclude-hosts.txt
	- Добавить IP-адреса: голосовых серверов Discord, Telegram, Cloudflare, Amazon, Hetzner, DigitalOcean, OVH и тд
4. Дождаться перезагрузки сервера. После загрузки сервера, заблокированные сайты заработают через несколько минут

***

## Настройка

### 1. Добавить свои сайты в список АнтиЗапрета
```sh
nano /root/antizapret/config/include-hosts.txt
```
Добавлять нужно в файл /root/antizapret/config/include-hosts.txt только домены, например:
subdomain.example.com
example.com
com
После этого нужно обновить список АнтиЗапрета
```sh
/root/antizapret/doall.sh
```

### 2. Исключить свои сайты из списка АнтиЗапрета
```sh
nano /root/antizapret/config/exclude-hosts.txt
```
Добавлять нужно в файл /root/antizapret/config/exclude-hosts.txt только домены, например:
subdomain.example.com
example.com
com
После этого нужно обновить список АнтиЗапрета
```sh
/root/antizapret/doall.sh
```

### 3. Добавить свои IP-адреса в список АнтиЗапрета
```sh
nano /root/antizapret/config/include-ips.txt
```
Добавлять нужно в файл /root/antizapret/config/include-ips.txt только IP-адреса с маской A.B.C.D/M, например:
8.8.8.8/32
10.20.0.0/16
20.30.40.0/24
После этого нужно обновить список АнтиЗапрета
```sh
/root/antizapret/doall.sh
```

***

## Пообщаться
Обсуждение скрипта на [4pda.to](https://4pda.to/forum/index.php?showtopic=1095869) и [ntc.party](https://ntc.party/t/9270) (для просмотра 4pda и ntc нужен VPN)
Приватная группа в [telegram](https://t.me/+XJwXHTmMvUk3NTli)

***

## Где купить сервер
Хорошие и быстрые сервера в Европе принимающие рубли:
- [vdsina.com](https://www.vdsina.com/?partner=9br77jaat2) (Нидерланды) - ссылка для регистрации с бонусом 10%
- [aeza.net](https://aeza.net/?ref=529527) (разные страны) - ссылка для регистрации с бонусом 15% если пополнение сделать в течении 24 часов с момента регистрации

Недорогие промо-сервера в Европе принимающие рубли:
- SWE-PROMO (Стокгольм) от [aeza.net](https://aeza.net/?ref=529527) - доступность для заказа SWE-PROMO можно отслеживать через [aezastatus_bot](https://t.me/aezastatus_bot)
- PROMO-Platinum (Франкфурт) от [h2.nexus](https://h2.nexus)

Регистрируясь и покупая по реферальным ссылкам Вы поддерживаете проект!

***

## FAQ

### 1. Какие IP-адреса используются?

DNS АнтиЗапрета = 10.29.0.1, 10.29.4.1, 10.29.8.1 (172.29.0.1, 172.29.4.1, 172.29.8.1)
Подменные IP АнтиЗапрета = 10.30.0.0/15 (172.30.0.0/15)
В скобках указаны альтернативные IP-адреса

### 2. Как работает опциональная защита от сканирования и сетевых атак?

IP-адрес блокируется на 10 минут при нарушении следующих правил:
- Сканирование портов: более 10 попыток подключения с одного IP-адреса или суммарно со всех IPv4-адресов подсети /24 или со всех IPv6-адресов подсети /64 по разным портам и протоколам
Если в течение минуты не было попыток подключения, лимит сбрасывается
- DDoS-атака: более 100 000 новых подключений с одного IP-адреса или суммарно со всех IPv4-адресов подсети /24 или со всех IPv6-адресов подсети /64 по разным портам и протоколам
Если в течение 10 секунд не было попыток подключения, лимит сбрасывается

При попытке подключения с заблокированного IP-адреса или подсети блокировка продлевается до 10 минут
Если подсеть или IP-адрес добавлен в список исключений, блокировка на него не распространяется

Отключен ответ на ping
Отключен ответ о неудачной попытке подключения к закрытому порту сервера

Список заблокированных IPv4- и IPv6-адресов
```sh
ipset list antizapret-block | grep '\.' | sort -u 
ipset list antizapret-block6 | grep -E '.*:.*:.*:' | sort -u
```
Список отслеживаемых подключений по IPv4 и IPv6 за последнюю минуту
```sh
ipset list antizapret-watch | grep '\.' | sort -u
ipset list antizapret-watch6 | grep -E '.*:.*:.*:' | sort -u
```
Список исключений IPv4 и IPv6
```sh
ipset list antizapret-allow | grep '\.' | sort -u
ipset list antizapret-allow6 | grep -E '.*:.*:.*:' | sort -u
```

Можно добавить IPv4-адреса исключений в файл /root/antizapret/config/allow-ips.txt 
```sh
nano /root/antizapret/config/allow-ips.txt 
```
После этого нужно обновить списки IP-адресов
```sh
/root/antizapret/parse.sh ip
```

### 3. Как работает опциональная защита SSH?

Подключение по SSH блокируется на минуту с 4 попытки подключения с одного IP-адреса или суммарно со всех IPv4-адресов подсети /24 или со всех IPv6-адресов подсети /64
Если в течение минуты с IP-адреса или подсети не было попыток подключения, лимит сбрасывается
При попытке подключения с заблокированного IP-адреса или подсети блокировка продлется на минуту

***
![Поблагодарить и поддержать](https://www.paypalobjects.com/en_US/i/btn/btn_donateCC_LG.gif)

Поблагодарить и поддержать проект можно на:

[cloudtips.ru](https://pay.cloudtips.ru/p/b3f20611)

[boosty.to](https://boosty.to/gubernievs)

